/*
 *  Bic Calendar - v3.2.2
 *  A simple twitter bootstrap calendar / agenda to mark events and select range of dates.
 *  http://bichotll.github.io/bic_calendar
 *
 *  Made by bichotll
 *  Under Apache License
 */
jQuery.fn.bic_calendar=function(e){var t=jQuery.extend({},jQuery.fn.bic_calendar.defaults,e);return this.each(function(){function e(){v=jQuery('<table class="table">'),n();var e=f.getMonth(),t=f.getFullYear();r(e,t);var i=jQuery('<td><a href="#" class="button-month-next"><i class="glyphicon glyphicon-arrow-right" ></i></a></td>');i.click(function(n){n.preventDefault(),e=(e+1)%12,a(e,t)});var d=jQuery('<td><a href="#" class="button-month-previous"><i class="glyphicon glyphicon-arrow-left" ></i></a></td>');d.click(function(n){n.preventDefault(),e-=1,-1==e&&(e=11),a(e,t)});var l=jQuery('<td><a href="#" class="button-year-next"><i class="glyphicon glyphicon-arrow-right" ></i></a></td>');l.click(function(n){n.preventDefault(),t++,a(e,t)});var s=jQuery('<td><a href="#" class="button-year-previous"><i class="glyphicon glyphicon-arrow-left" ></i></a></td>');s.click(function(n){n.preventDefault(),t--,a(e,t)});var p=jQuery('<table class="table header"></table>');if(S===!0){var _=jQuery("<tr></tr>"),m=jQuery('<td colspan=5 class="monthAndYear span6"></td>');_.append(s),_.append(m),_.append(l),m.append(g),p.append(_)}if(Y===!0){var Q=jQuery("<tr></tr>"),b=jQuery('<td colspan=5 class="monthAndYear span6"></td>');Q.append(d),Q.append(b),Q.append(i),b.append(h),p.append(Q)}u=jQuery('<div class="bic_calendar row" id="'+j+'" ></div>'),u.prepend(p),u.append(v),y.append(u),o(e,t),c()}function a(e,t){v.empty(),n(),r(e,t),o(e,t),p()}function n(){if(0!=D){var e=jQuery('<tr class="days-month" >'),t="";jQuery(Q).each(function(e,a){t+="<td",0==e&&(t+=' class="first"'),6==e&&(t+=' class="sunday last"'),t+=">"+a+"</td>"}),t+="</tr>",e.append(t),v.append(e)}}function r(e,t){h.text(b[e]),g.text(t);for(var a=1,n=i(1,e,t),r=l(e,t),d=e+1,o="",s=0;7>s;s++){if(n>s){var c="";0==s&&(c+="<tr>"),c+='<td class="invalid-day week-day-'+s+'"',c+='"></td>'}else{var c="";0==s&&(c+="<tr>"),c+='<td id="'+j+"_"+a+"_"+d+"_"+t+'" data-date="'+d+"/"+a+"/"+t+'" ',c+=' class="day week-day-'+s+'"',c+='><div><a><div class="bic_calendar_day_num">'+a+"</div></a></div></span>",6==s&&(c+="</tr>"),a++}o+=c}for(var p=1;r>=a;){var c="";p%7==1&&(c+="<tr>"),c+='<td id="'+j+"_"+a+"_"+d+"_"+t+'" data-date="'+d+"/"+a+"/"+t+'" ',c+=' class="day week-day-'+(p-1)%7+'"',c+='><div><a><div class="bic_calendar_day_num">'+a+"</div></a></div></td>",p%7==0&&(c+="</tr>"),a++,p++,o+=c}if(p--,p%7!=0){c="";for(var s=p%7+1;7>=s;s++){var c="";c+="<td ",c+=' class="invalid-day week-day-'+(s-1)+'"',c+='"></td>',7==s&&(c+="</tr>"),o+=c}}v.append(o)}function i(e,t,a){var n=new Date(a,t,e),r=n.getDay();return r+=A,0==r?r=6:r--,r}function d(e,t,a){return e>0&&13>e&&a>0&&32768>a&&t>0&&t<=new Date(a,e,0).getDate()}function l(e,t){for(var a=28;d(e+1,a+1,t);)a++;return a}function o(e,t){0!=w?jQuery.ajax({type:w.type,url:w.url,data:{mes:e+1,ano:t},dataType:"json"}).done(function(a){"undefined"==typeof _&&(_=[]),jQuery.each(a,function(e,t){_.push(a[e])}),s(e,t)}):s(e,t)}function s(e,t){for(var a=e+1,n=0;n<_.length;n++)if(_[n].date.split("/")[1]==a&&_[n].date.split("/")[2]==t){var r=jQuery("#"+j+"_"+_[n].date.replace(/\//g,"_")),i=jQuery("#"+j+"_"+_[n].date.replace(/\//g,"_")+" a");r.addClass("event"),i.attr("data-original-title",_[n].title),_[n].color&&r.css("background",_[n].color),"undefined"!=typeof _[n].link&&""!=_[n].link&&i.attr("href",_[n].link),"undefined"!=typeof _[n].linkTarget&&""!=_[n].linkTarget&&i.attr("target",_[n].linkTarget),_[n]["class"]&&r.addClass(_[n]["class"]),_[n].content?(r.addClass("event_popover"),i.attr("rel","popover"),i.attr("data-content",_[n].content)):(r.addClass("event_tooltip"),i.attr("rel","tooltip"))}jQuery("#"+j+" .event_tooltip a").tooltip(C),jQuery("#"+j+" .event_popover a").popover(k),jQuery(".manual_popover").click(function(){jQuery(this).popover("toggle")})}function c(){if(1==x){y.on("click","td.day",function(){if(1==M)if(""==E)E=jQuery(this).data("date"),p();else if(""==I){F=E,I=jQuery(this).data("date"),p();var e=new CustomEvent("bicCalendarSelect",{detail:{dateFirst:F,dateLast:I}});document.dispatchEvent(e)}else F="",I="",E="",y.find(".selection").removeClass("middle-selection selection first-selection last-selection");else{y.find("td div").removeClass("selection"),jQuery(this).find("div").addClass("selection");var e=new CustomEvent("bicCalendarSelect",{detail:{date:jQuery(this).data("date")}});document.dispatchEvent(e)}})}}function p(){if(""!=E&&""==F){var e=E.split("/");jQuery("#bic_calendar_"+e[1]+"_"+e[0]+"_"+e[2]+" div").addClass("selection")}else if(""!=F){F.split("/"),I.split("/");y.find("td.selection").removeClass("selection");var t=new Date(F),a=new Date(I);if(t>a){var n=t;t=a,a=n}for(jQuery("#bic_calendar_"+t.getDate()+"_"+(parseInt(t.getMonth())+1)+"_"+t.getFullYear()+" div").addClass("selection first-selection");a>t;)t.setDate(t.getDate()+1),jQuery("#bic_calendar_"+t.getDate()+"_"+(parseInt(t.getMonth())+1)+"_"+t.getFullYear()+" div").addClass("selection middle-selection");jQuery("#bic_calendar_"+t.getDate()+"_"+(parseInt(t.getMonth())+1)+"_"+t.getFullYear()+" div").removeClass("middle-selection").addClass("selection last-selection")}}var u,v,f,y=jQuery(this),h=jQuery('<div class="visualmonth"></div>'),g=jQuery('<div class="visualyear"></div>'),j="bic_calendar",_=t.events;if(t.date)if("string"==typeof t.date){var m=t.date.split("/");f=new Date(parseInt(m[2]),parseInt(m[1])-1,parseInt(m[0]))}else f=t.date;else f=new Date;var Q;Q="undefined"!=typeof t.dayNames?t.dayNames:["l","m","x","j","v","s","d"];var b;b="undefined"!=typeof t.monthNames?t.monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];var D;D="undefined"!=typeof t.showDays?t.showDays:!0;var k;k="undefined"!=typeof t.popoverOptions?t.popoverOptions:{placement:"bottom",html:!0,trigger:"click",template:'<div class="popover" role="tooltip"><h3 class="popover-title"></h3><div class="manual_popover">x</div><div class="popover-content"></div></div>'};var C;C="undefined"!=typeof t.tooltipOptions?t.tooltipOptions:{placement:"bottom",trigger:"focus"};var w;w="undefined"!=typeof t.reqAjax?t.reqAjax:!1;var x=!1;"undefined"!=typeof t.enableSelect&&(x=t.enableSelect);var M=!1;"undefined"!=typeof t.multiSelect&&(M=t.multiSelect);var Y=!0;"undefined"!=typeof t.displayMonthController&&(Y=t.displayMonthController);var S=!0;"undefined"!=typeof t.displayYearController&&(S=t.displayYearController);var A=0;"undefined"!=typeof t.startWeekDay&&(A=t.startWeekDay);var F="",I="",E="";e()}),this},jQuery(document).ready(function(){jQuery("#bic_calendar").length>=1&&jQuery("#bic_calendar").delegate(".manual_popover","click",function(){var e=jQuery(this).parents("td");jQuery("a",e).popover("toggle")})});